{"version":3,"sources":["../../src/tests/actions-cascade-one.spec.js"],"names":["should","micro","plugins","schema","type","number","tableName","before","run","then","act","createTable","after","dropTable","end","describe","CASCADE_SAVE_ONE","required","originalName","propertyName","pins","remove","create","update","it","params","id","options","fields","result","all","exist","be","a","with","length","have","property","equal","original","undefined","connection","createTableIfNotExists","table","increments","integer","properties","dbName","dropTableIfExists"],"mappings":"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","file":"actions-cascade-one.spec.js","sourcesContent":["import chai from 'chai';\nimport Micro, { LEVEL_ERROR } from '@microjs/microjs';\nimport { CONNECT_OPTIONS, CONNECT_OPTIONS_PG } from './constants';\nimport Plugin, {\n  Schema,\n  SchemaTypes,\n  PIN_CONNECTION,\n  PIN_CASCADE_SAVE_ONE,\n  PIN_CASCADE_SAVE_MANY,\n  PIN_CASCADE_REMOVE,\n  PIN_LIST_CREATE,\n  PIN_LIST_UPDATE,\n  PIN_LIST_FIND_ONE,\n  PIN_LIST_FIND_LIST,\n  PIN_LIST_REMOVE\n} from '../index';\n\nconst should = chai.should();\nconst micro = Micro({\n  // level  : LEVEL_ERROR,\n  plugins: [ Plugin(CONNECT_OPTIONS_PG) ]\n});\n\nconst schema = new Schema('CascadeDependent', {\n  'number': {\n    type: SchemaTypes.number\n  }\n}, {\n  tableName: 'module_cascade_one_dependent_db'\n});\n\nbefore(() => micro\n  .run()\n  .then(() => micro.act(PIN_CONNECTION))\n  .then(createTable)\n);\nafter(() => micro.act(PIN_CONNECTION)\n  .then(dropTable)\n  .then(() => micro.end()));\n\ndescribe('actions-cascade-one', function() {\n  const CASCADE_SAVE_ONE = {\n    ...PIN_CASCADE_SAVE_ONE,\n    required    : false,\n    originalName: 'owner',\n    propertyName: 'preview',\n    pins        : {\n      remove: { ...PIN_LIST_REMOVE, schema },\n      create: { ...PIN_LIST_CREATE, schema },\n      update: { ...PIN_LIST_UPDATE, schema }\n    }\n  };\n\n  it('#save-one (create)', () => micro\n    .act({ ...CASCADE_SAVE_ONE,\n      params: { number: 1 }\n    })\n    .then(({ id }) => micro.act({ ...PIN_LIST_FIND_LIST, schema, options: { fields: 'full' } }))\n    .then(result => Promise.all([\n      should.exist(result),\n      result.should.be.a('array').with.length(1),\n      result[ 0 ].should.be.a('object'),\n      result[ 0 ].should.have.property('number').be.a('number').equal(1),\n    ]))\n  );\n\n  it('#save-one (update)', () => micro\n    .act({ ...CASCADE_SAVE_ONE,\n      original: { id: 1, number: 1 },\n      params  : { id: 1, number: 2 }\n    })\n    .then(({ id }) => micro.act({ ...PIN_LIST_FIND_LIST, schema, options: { fields: 'full' } }))\n    .then(result => Promise.all([\n      should.exist(result),\n      result.should.be.a('array').with.length(1),\n      result[ 0 ].should.be.a('object'),\n      result[ 0 ].should.have.property('number').be.a('number').equal(2),\n    ]))\n  );\n\n  it('#save-one (not save / not remove)', () => micro\n    .act({ ...CASCADE_SAVE_ONE,\n      original: { id: 1, number: 2 },\n      params  : undefined\n    })\n    .then(() => micro.act({ ...PIN_LIST_FIND_LIST, schema, options: { fields: 'full' } }))\n    .then(result => Promise.all([\n      should.exist(result),\n      result.should.be.a('array').with.length(1),\n      result[ 0 ].should.be.a('object'),\n      result[ 0 ].should.have.property('number').be.a('number').equal(2),\n    ]))\n  );\n\n  it('#save-one (remove)', () => micro\n    .act({ ...CASCADE_SAVE_ONE,\n      original: { id: 1, number: 2 },\n      params  : null\n    })\n    .then(({ id }) => micro.act({ ...PIN_LIST_FIND_LIST, schema, options: { fields: 'full' } }))\n    .then(result => Promise.all([\n      should.exist(result),\n      result.should.be.a('array').with.length(0)\n    ]))\n  );\n\n});\n\nfunction createTable(connection) {\n  return connection.schema.createTableIfNotExists(schema.tableName, function (table) {\n    table.increments();\n    table.integer(schema.properties[ 'number' ].dbName);\n  });\n}\n\nfunction dropTable(connection) {\n  return connection.schema.dropTableIfExists(schema.tableName);\n}\n"]}