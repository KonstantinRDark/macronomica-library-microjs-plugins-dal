{"version":3,"sources":["../src/plugin.js"],"names":["client","driver","connection","app","onClose","plugin","id","schema","name","options","useNullAsDefault","middleware","add","Promise","resolve","handlerOnClose","del"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;;;kBAEe,YAA2C;AAAA,iFAAP,EAAO;;AAAA,MAAjCA,MAAiC,QAAxCC,MAAwC;AAAA,MAAtBC,UAAsB;;AACxD,SAAO,CAACC,GAAD,YAAsB;AAAA,QAAdC,OAAc,SAAdA,OAAc;;AAC3B,UAAMC,SAAS,EAAEC,IAAI,qBAAN,EAAeC,QAASC,IAAD,IAAU,CAAE,CAAnC,EAAf;AACA,UAAMC,UAAU;AACdT,YADc;AAEdE,gBAFc;AAGdQ,wBAAkB;AAHJ,KAAhB;AAKA,UAAMC,aAAa,oBAAKF,OAAL,CAAnB;;AAEAN,QAAIS,GAAJ,oBAAqB;AAAA;;AAAA,aAASC,QAAQC,OAAR,CAAgBL,OAAhB,CAAT;AAAA,KAArB;AACAN,QAAIS,GAAJ,uBAAwB;AAAA;;AAAA,aAASC,QAAQC,OAAR,CAAgBH,UAAhB,CAAT;AAAA,KAAxB;;AAEA,2BAAQR,GAAR,EAAaE,MAAb,EAAqB,EAAEM,UAAF,EAAcP,OAAd,EAArB;;AAEAA,YAAQW,cAAR;AACD,GAfD;AAgBD,C;;AAED,SAASA,cAAT,CAAwBZ,GAAxB,EAA6B;AAC3BA,MAAIa,GAAJ;AACAb,MAAIa,GAAJ;AACD","file":"plugin.js","sourcesContent":["import { genid } from '@microjs/microjs';\nimport knex from 'knex';\nimport modules from './modules';\nimport { PIN_OPTIONS, PIN_CONNECTION } from './pins';\n\nexport default ({ driver:client, ...connection } = {}) => {\n  return (app, { onClose }) => {\n    const plugin = { id: genid(), schema: (name) => {} };\n    const options = {\n      client,\n      connection,\n      useNullAsDefault: true\n    };\n    const middleware = knex(options);\n\n    app.add(PIN_OPTIONS, ({ }) => Promise.resolve(options));\n    app.add(PIN_CONNECTION, ({ }) => Promise.resolve(middleware));\n\n    modules(app, plugin, { middleware, onClose });\n\n    onClose(handlerOnClose);\n  };\n};\n\nfunction handlerOnClose(app) {\n  app.del(PIN_CONNECTION);\n  app.del(PIN_OPTIONS);\n}"]}