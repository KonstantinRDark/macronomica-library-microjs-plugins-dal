{"version":3,"sources":["../../src/actions/count.js"],"names":["buildCount","middleware","micro","plugin","schema","criteria","options","sql","Promise","resolve","reject","getMyParams","table","tableName","builder","count","toSQL","then","catch","code","message","error","detail","split"],"mappings":";;;;;;;;QAOgBA,U,GAAAA,U;;AAPhB;;;;AACA;;;;kBAEe,UAACC,UAAD,EAAaC,KAAb,EAAoBC,MAApB;AAAA,SACb,UAACC,MAAD,EAASC,QAAT,EAAmBC,OAAnB;AAAA,WACEN,WAAWC,UAAX,EAAuBG,MAAvB,EAA+BC,QAA/B,EAAyCC,OAAzC,CADF;AAAA,GADa;AAAA,C;;AAIR,SAASN,UAAT,CAAqBC,UAArB,EAAiCG,MAAjC,EAA8E;AAAA,MAArCC,QAAqC,uEAA1B,EAA0B;;AAAA,iFAAJ,EAAI;AAAA,sBAApBE,GAAoB;AAAA,MAApBA,GAAoB,4BAAd,KAAc;;AACnF,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCL,eAAWD,OAAOO,WAAP,CAAmBN,QAAnB,CAAX;;AAEA,QAAMO,QAAQX,WAAWG,OAAOS,SAAlB,CAAd;;AAEA,QAAMC,UAAU,2BAAYF,KAAZ,EAAmBP,QAAnB,EAA6BK,MAA7B,EACbK,KADa,EAAhB;;AAGA,QAAIR,GAAJ,EAAS;AACP,aAAOE,QAAQK,QAAQE,KAAR,EAAR,CAAP;AACD;;AAED,WAAOF,QACJG,IADI,CACC,iBAAmB;AAAA;AAAA,UAAdF,KAAc,YAAdA,KAAc;;AACvB,aAAO,EAAEA,OAAO,CAACA,KAAV,EAAP;AACD,KAHI,EAIJE,IAJI,CAICR,OAJD,EAKJS,KALI,CAKE,iBAAS;AACdR,aAAO;AACLS,oCADK;AAELC,iBAASC,MAAMC,MAAN,IAAgBD,MAAMD,OAAN,CAAcG,KAAd,CAAoB,KAApB,EAA4B,CAA5B;AAFpB,OAAP;AAID,KAVI,CAAP;AAWD,GAvBM,CAAP;AAwBD","file":"count.js","sourcesContent":["import setCriteria from './../utils/set-criteria';\nimport { ERROR_COUNT } from './constants';\n\nexport default (middleware, micro, plugin) =>\n  (schema, criteria, options) =>\n    buildCount(middleware, schema, criteria, options);\n\nexport function buildCount (middleware, schema, criteria = {}, { sql = false } = {}) {\n  return new Promise((resolve, reject) => {\n    criteria = schema.getMyParams(criteria);\n\n    const table = middleware(schema.tableName);\n\n    const builder = setCriteria(table, criteria, reject)\n      .count();\n\n    if (sql) {\n      return resolve(builder.toSQL());\n    }\n\n    return builder\n      .then(([ { count } ]) => {\n        return { count: +count };\n      })\n      .then(resolve)\n      .catch(error => {\n        reject({\n          code   : ERROR_COUNT,\n          message: error.detail || error.message.split(' - ')[ 1 ]\n        });\n      });\n  });\n}"]}