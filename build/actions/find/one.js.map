{"version":3,"sources":["../../../src/actions/find/one.js"],"names":["buildFindOne","middleware","micro","plugin","schema","criteria","options","fields","sql","Promise","resolve","reject","getMyParams","convertOuts","properties","table","tableName","builder","select","getMyFields","limit","toSQL","then","result","name","callback","catch","code","message","error","detail","split"],"mappings":";;;;;;;;;;QASgBA,Y,GAAAA,Y;;AAThB;;;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACC,UAAD,EAAaC,KAAb,EAAoBC,MAApB;AAAA,SACb,UAACC,MAAD;AAAA,QAASC,QAAT,uEAAoB,EAApB;AAAA,QAAwBC,OAAxB;AAAA,WACEN,aAAaC,UAAb,EAAyBG,MAAzB,EAAiCC,QAAjC,EAA2CC,OAA3C,CADF;AAAA,GADa;AAAA,C;;AAIR,SAASN,YAAT,CAAsBC,UAAtB,EAAkCG,MAAlC,EAAuF;AAAA,MAA7CC,QAA6C,uEAAlC,EAAkC;;AAAA,iFAAJ,EAAI;AAAA,MAA5BE,MAA4B,QAA5BA,MAA4B;AAAA,sBAApBC,GAAoB;AAAA,MAApBA,GAAoB,4BAAd,KAAc;;AAC5F,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAAA;;AACtCN,eAAWD,OAAOQ,WAAP,CAAmBP,QAAnB,CAAX;AACA,QAAMQ,cAAc,+BAAgBT,OAAOU,UAAvB,CAApB;;AAEA,QAAI,sBAAQT,QAAR,CAAJ,EAAuB;AACrB,aAAOK,QAAQ,IAAR,CAAP;AACD;;AAED,QAAMK,QAAQd,WAAWG,OAAOY,SAAlB,CAAd;AACA,QAAMC,UAAU,2CAAYF,KAAZ,EAAmBV,QAAnB,EAA6BM,MAA7B,GACbO,MADa,wCACHd,OAAOe,WAAP,CAAmBZ,MAAnB,CADG,GAEba,KAFa,CAEP,CAFO,CAAhB;;AAIA,QAAIZ,GAAJ,EAAS;AACP,aAAOE,QAAQO,QAAQI,KAAR,EAAR,CAAP;AACD;;AAEDJ,YACGK,IADH,CACQ,YAAqB;AAAA,sFAAP,EAAO;AAAA;AAAA,UAAlBC,MAAkB;;AACzB,UAAG,CAACA,MAAJ,EAAY;AACVb,gBAAQ,IAAR;AACD;;AAHwB;AAAA;AAAA;;AAAA;AAKzB,6BAA+BG,WAA/B,8HAA4C;AAAA;AAAA,cAAjCW,IAAiC,SAAjCA,IAAiC;AAAA,cAA3BC,QAA2B,SAA3BA,QAA2B;;AAC1CF,iBAAQC,IAAR,IAAiBC,SAASF,OAAQC,IAAR,CAAT,EAAyBpB,OAAOU,UAAP,CAAmBU,IAAnB,CAAzB,CAAjB;AACD;AAPwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AASzBd,2BAAaa,MAAb;AACD,KAXH,EAYGG,KAZH,CAYS,iBAAS;AACdf,aAAO;AACLgB,uCADK;AAELC,iBAASC,MAAMC,MAAN,IAAgBD,MAAMD,OAAN,CAAcG,KAAd,CAAoB,KAApB,EAA4B,CAA5B;AAFpB,OAAP;AAID,KAjBH;AAkBD,GAnCM,CAAP;AAoCD","file":"one.js","sourcesContent":["import isEmpty from 'lodash.isempty';\nimport setCriteria from './../../utils/set-criteria';\nimport checkConvertOut from './../../utils/check-convert-out';\nimport { ERROR_FIND_ONE } from './../constants';\n\nexport default (middleware, micro, plugin) =>\n  (schema, criteria = {}, options) =>\n    buildFindOne(middleware, schema, criteria, options);\n\nexport function buildFindOne(middleware, schema, criteria = {}, { fields, sql = false } = {}) {\n  return new Promise((resolve, reject) => {\n    criteria = schema.getMyParams(criteria);\n    const convertOuts = checkConvertOut(schema.properties);\n\n    if (isEmpty(criteria)) {\n      return resolve(null);\n    }\n\n    const table = middleware(schema.tableName);\n    const builder = setCriteria(table, criteria, reject)\n      .select(...schema.getMyFields(fields))\n      .limit(1);\n\n    if (sql) {\n      return resolve(builder.toSQL());\n    }\n\n    builder\n      .then(([ result ] = []) => {\n        if(!result) {\n          resolve(null);\n        }\n\n        for (let { name, callback } of convertOuts) {\n          result[ name ] = callback(result[ name ], schema.properties[ name ]);\n        }\n\n        resolve({ ...result });\n      })\n      .catch(error => {\n        reject({\n          code   : ERROR_FIND_ONE,\n          message: error.detail || error.message.split(' - ')[ 1 ]\n        });\n      });\n  });\n}"]}