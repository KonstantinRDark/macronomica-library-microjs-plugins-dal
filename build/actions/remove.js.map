{"version":3,"sources":["../../src/actions/remove.js"],"names":["buildRemove","middleware","micro","plugin","schema","criteria","options","Promise","resolve","reject","getMyParams","table","tableName","builder","del","returning","then","catch","code","message","error","detail","split"],"mappings":";;;;;QAQgBA,W,GAAAA,W;;AARhB;;;;AACA;;;;AACA;;;;kBAEe,UAACC,UAAD,EAAaC,KAAb,EAAoBC,MAApB;AAAA,SACb,UAACC,MAAD,EAASC,QAAT,EAAmBC,OAAnB;AAAA,WACEN,YAAYC,UAAZ,EAAwBG,MAAxB,EAAgCC,QAAhC,EAA0CC,OAA1C,CADF;AAAA,GADa;AAAA,C;;AAIR,SAASN,WAAT,CAAsBC,UAAtB,EAAkCG,MAAlC,EAAyD;AAAA,MAAfC,QAAe,uEAAJ,EAAI;;AAC9D,SAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCJ,eAAWD,OAAOM,WAAP,CAAmBL,QAAnB,CAAX;;AAEA,QAAI,sBAAQA,QAAR,CAAJ,EAAuB;AACrB,aAAOG,QAAQ,IAAR,CAAP;AACD;;AAED,QAAMG,QAAQV,WAAWG,OAAOQ,SAAlB,CAAd;AACA,QAAMC,UAAU,2BAAYF,KAAZ,EAAmBN,QAAnB,EAA6BI,MAA7B,EACbK,GADa,GAEbC,SAFa,CAEH,IAFG,CAAhB;;AAIAF,YACGG,IADH,CACQR,OADR,EAEGS,KAFH,CAES,iBAAS;AACdR,aAAO;AACLS,qCADK;AAELC,iBAASC,MAAMC,MAAN,IAAgBD,MAAMD,OAAN,CAAcG,KAAd,CAAoB,KAApB,EAA4B,CAA5B;AAFpB,OAAP;AAID,KAPH;AAQD,GApBM,CAAP;AAqBD","file":"remove.js","sourcesContent":["import isEmpty from 'lodash.isempty';\nimport setCriteria from './../utils/set-criteria';\nimport { ERROR_REMOVE } from './constants';\n\nexport default (middleware, micro, plugin) =>\n  (schema, criteria, options) =>\n    buildRemove(middleware, schema, criteria, options);\n\nexport function buildRemove (middleware, schema, criteria = {}) {\n  return new Promise((resolve, reject) => {\n    criteria = schema.getMyParams(criteria);\n\n    if (isEmpty(criteria)) {\n      return resolve(null);\n    }\n\n    const table = middleware(schema.tableName);\n    const builder = setCriteria(table, criteria, reject)\n      .del()\n      .returning('id');\n\n    builder\n      .then(resolve)\n      .catch(error => {\n        reject({\n          code   : ERROR_REMOVE,\n          message: error.detail || error.message.split(' - ')[ 1 ]\n        });\n      });\n  });\n}"]}