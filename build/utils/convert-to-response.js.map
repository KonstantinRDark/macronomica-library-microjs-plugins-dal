{"version":3,"sources":["../../src/utils/convert-to-response.js"],"names":["convertToResponse","schema","fields","resultData","constructor","name","result","names","dbName","dbProperties","property","properties","value","type","convertOut","undefined","str"],"mappings":";;;;;;;;;;kBAIwBA,iB;;AAJxB;;;;AACA;;;;AACA;;;;;;AAEe,SAASA,iBAAT,CAA2BC,MAA3B,EAAmCC,MAAnC,EAA2C;AACxD,SAAOC,cAAc;AACnB,QAAI,sBAAcA,UAAd,KAA6BA,WAAWC,WAAX,CAAuBC,IAAvB,KAAgC,WAAjE,EAA8E;AAC5E,UAAIC,SAAS,EAAb;AACA,UAAIC,QAAQ,oBAAYJ,UAAZ,CAAZ;;AAEA,WAAK,IAAIK,MAAT,IAAmBD,KAAnB,EAA0B;AACxB,YAAIF,OAAOJ,OAAOQ,YAAP,CAAqBD,MAArB,EAA8BH,IAAzC;AACA,YAAIK,WAAWT,OAAOU,UAAP,CAAmBN,IAAnB,CAAf;AACA,YAAIO,QAAQT,WAAYK,MAAZ,CAAZ;;AAEA,YAAI,gBAAgBE,SAASG,IAA7B,EAAmC;AACjCD,kBAAQF,SAASG,IAAT,CAAcC,UAAd,CAAyBF,KAAzB,EAAgCF,QAAhC,CAAR;AACD;;AAED,YAAIE,UAAUG,SAAV,IAAuBH,UAAU,IAAjC,IAAyCA,UAAU,EAAvD,EAA2D;AACzD;AACD;;AAEDN,iBAAS,oBAAIU,GAAJ,CAAQX,IAAR,EAAcO,KAAd,EAAqBN,MAArB,CAAT;AACD;;AAED,aAAOA,MAAP;AACD,KArBD,MAqBO;AACL,UAAIA,SAAS,EAAb;AACA;AACA,UAAIE,SAASN,OAAQ,CAAR,CAAb;AACA,UAAIU,QAAQT,WAAY,CAAZ,KAAmBA,UAA/B;AACA,UAAIE,OAAOJ,OAAOQ,YAAP,CAAqBD,MAArB,EAA8BH,IAAzC;AACA,UAAIK,WAAWT,OAAOU,UAAP,CAAmBN,IAAnB,CAAf;;AAEA,UAAI,gBAAgBK,SAASG,IAA7B,EAAmC;AACjCD,gBAAQF,SAASG,IAAT,CAAcC,UAAd,CAAyBF,KAAzB,EAAgCF,QAAhC,CAAR;AACD;;AAED,UAAIE,UAAUG,SAAV,IAAuBH,UAAU,IAAjC,IAAyCA,UAAU,EAAvD,EAA2D;AACzD,eAAON,MAAP;AACD;;AAEDA,eAAS,oBAAIU,GAAJ,CAAQX,IAAR,EAAcO,KAAd,EAAqBN,MAArB,CAAT;AACA,aAAOA,MAAP;AACD;AACF,GAzCD;AA0CD","file":"convert-to-response.js","sourcesContent":["import dot from 'dot-object';\nimport isPlainObject from 'lodash.isplainobject';\nimport checkConvertOut from './check-convert-out';\n\nexport default function convertToResponse(schema, fields) {\n  return resultData => {\n    if (isPlainObject(resultData) || resultData.constructor.name === 'anonymous') {\n      let result = {};\n      let names = Object.keys(resultData);\n\n      for (let dbName of names) {\n        let name = schema.dbProperties[ dbName ].name;\n        let property = schema.properties[ name ];\n        let value = resultData[ dbName ];\n\n        if ('convertOut' in property.type) {\n          value = property.type.convertOut(value, property);\n        }\n\n        if (value === undefined || value === null || value === '') {\n          continue;\n        }\n\n        result = dot.str(name, value, result);\n      }\n\n      return result;\n    } else {\n      let result = {};\n      // Берем первое указанное имя в fields, по идее оно там одно\n      let dbName = fields[ 0 ];\n      let value = resultData[ 0 ] || resultData;\n      let name = schema.dbProperties[ dbName ].name;\n      let property = schema.properties[ name ];\n      \n      if ('convertOut' in property.type) {\n        value = property.type.convertOut(value, property);\n      }\n\n      if (value === undefined || value === null || value === '') {\n        return result;\n      }\n\n      result = dot.str(name, value, result);\n      return result;\n    }\n  };\n}"]}